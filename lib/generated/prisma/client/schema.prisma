// ============================================================
// prisma/schema.prisma
// Aligned with ER diagram: Users, Enroll, Athletes, Leaders,
// AthleteParticipat, LeaderParticipat, Sports, Events,
// categories, Sports_event_org, Organization, Medals
// ============================================================

generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated/prisma/client"
}

datasource db {
  provider = "postgresql"
}

// ── Users ─────────────────────────────────────────────────────

model Users {
  userID    Int      @id @default(autoincrement())
  username  String   @unique
  password  String
  userLevel Int      @default(0)
  photoPath String?
  createdAt DateTime @default(now())

  Enroll Enroll[]
}

// ── Enroll (base participant record) ─────────────────────────

enum IdDocType {
  IDCard
  BirthCertificate
}

model Enroll {
  id            Int       @id @default(autoincrement())
  userID        Int
  name          String
  gender        String // 'Male' | 'Female'
  nationality   String
  dob           DateTime
  idDocType     IdDocType
  address       String?
  photoPath     String?
  DocumentsPath String?
  createdAt     DateTime  @default(now())

  user     Users     @relation(fields: [userID], references: [userID])
  athletes Athletes?
  leaders  Leaders?
}

// ── Athletes ──────────────────────────────────────────────────

model Athletes {
  id          Int      @id @default(autoincrement())
  enrollID    Int      @unique // 1:1 with Enroll
  class       String?
  uniformSize String?
  createdAt   DateTime @default(now())

  enroll            Enroll              @relation(fields: [enrollID], references: [id])
  AthleteParticipat AthleteParticipat[]
}

// ── Leaders ───────────────────────────────────────────────────

enum LeaderRole {
  coach
  manager
  delegate
  team_lead
  coach_trainer
  teacher_assistant
}

model Leaders {
  id          Int        @id @default(autoincrement())
  enrollID    Int        @unique // 1:1 with Enroll
  roles       LeaderRole
  phoneNumber String     @unique
  createdAt   DateTime   @default(now())

  enroll           Enroll             @relation(fields: [enrollID], references: [id])
  LeaderParticipat LeaderParticipat[]
}

// ── Events ────────────────────────────────────────────────────

model Events {
  id        Int      @id @default(autoincrement())
  name      String
  date      DateTime
  createdAt DateTime @default(now())

  categories        categories[]
  AthleteParticipat AthleteParticipat[]
  LeaderParticipat  LeaderParticipat[]
  Sports_event_org  Sports_event_org[]
}

// ── Sports ────────────────────────────────────────────────────

model Sports {
  id        Int      @id @default(autoincrement())
  name      String
  createdAt DateTime @default(now())

  categories        categories[]
  AthleteParticipat AthleteParticipat[]
  LeaderParticipat  LeaderParticipat[]
  Sports_event_org  Sports_event_org[]
}

// ── Organization ─────────────────────────────────────────────

model Organization {
  id        Int      @id @default(autoincrement())
  name      String
  createdAt DateTime @default(now())

  AthleteParticipat AthleteParticipat[]
  LeaderParticipat  LeaderParticipat[]
  Sports_event_org  Sports_event_org[]
}

// ── categories (Events × Sports join) ────────────────────────

model categories {
  id        Int      @id @default(autoincrement())
  events_id Int
  sportsID  Int
  category  String
  createdAt DateTime @default(now())

  events            Events              @relation(fields: [events_id], references: [id])
  sports            Sports              @relation(fields: [sportsID], references: [id])
  AthleteParticipat AthleteParticipat[]
}

// ── Sports_event_org (Sports × Events × Org join) ────────────

model Sports_event_org {
  id              Int      @id @default(autoincrement())
  events_id       Int
  sports_id       Int
  organization_id Int
  createdAt       DateTime @default(now())

  events       Events       @relation(fields: [events_id], references: [id])
  sports       Sports       @relation(fields: [sports_id], references: [id])
  organization Organization @relation(fields: [organization_id], references: [id])
}

// ── AthleteParticipat ─────────────────────────────────────────

model AthleteParticipat {
  id             Int      @id @default(autoincrement())
  athletesID     Int
  eventsID       Int
  categoriesID   Int
  sportsID       Int
  organizationID Int
  createdAt      DateTime @default(now())

  athletes     Athletes     @relation(fields: [athletesID], references: [id])
  events       Events       @relation(fields: [eventsID], references: [id])
  categories   categories   @relation(fields: [categoriesID], references: [id])
  sports       Sports       @relation(fields: [sportsID], references: [id])
  organization Organization @relation(fields: [organizationID], references: [id])
  Medals       Medals[]
}

// ── LeaderParticipat ──────────────────────────────────────────

model LeaderParticipat {
  id             Int      @id @default(autoincrement())
  leadersID      Int
  eventsID       Int
  sportsID       Int
  organizationID Int
  createdAt      DateTime @default(now())

  leaders      Leaders      @relation(fields: [leadersID], references: [id])
  events       Events       @relation(fields: [eventsID], references: [id])
  sports       Sports       @relation(fields: [sportsID], references: [id])
  organization Organization @relation(fields: [organizationID], references: [id])
}

// ── Medals ────────────────────────────────────────────────────

enum MedalType {
  gold
  silver
  bronze
}

model Medals {
  id                 Int       @id @default(autoincrement())
  athletesParticipID Int
  medals_type        MedalType
  key_performance    String?
  createdAt          DateTime  @default(now())

  athleteParticipat AthleteParticipat @relation(fields: [athletesParticipID], references: [id])
}
